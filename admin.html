<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Admin-Panel | ITMA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script>
    (function() {
        try {
            const user = JSON.parse(localStorage.getItem('teacher'));
            const adminLogins = ['shaxnoza', 'furkat', 'matlyuba', 'admin'];
            if (!user || !adminLogins.includes(user.login)) {
                window.location.replace('index.html');
            }
        } catch (e) {
            window.location.replace('index.html');
        }
    })();
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<div class="container py-5">
    <div class="language-picker mb-4">
        <div class="glass-btn-group" id="langGroup">
            <div class="lang-slider"></div> 
            <button id="lang-ru" class="btn-lang active">
                <img src="https://upload.wikimedia.org/wikipedia/commons/f/f3/Flag_of_Russia.svg" alt="RU"> –†—É—Å
            </button>
            <button id="lang-uz" class="btn-lang">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Flag_of_Uzbekistan.svg" alt="UZ"> Uzb
            </button>
        </div>
    </div>

    <h2 data-i18n="admin_panel_title" class="main-title text-center">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ITMA</h2>

    <div class="control-panel mb-5 mt-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="dateFilter" class="form-label text-white fw-medium" data-i18n="choose_date">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
                <select id="dateFilter" class="form-select custom-select"></select>
            </div>
            <div class="col-md-8 d-flex justify-content-md-end gap-2 flex-wrap">
                <button type="button" class="btn btn-action btn-primary-custom" data-bs-toggle="modal" data-bs-target="#excelModal">
                    <span class="me-1">üìÑ</span> <span data-i18n="export_excel">Excel –æ—Ç—á—ë—Ç</span>
                </button>
                <button id="clearHistory" class="btn btn-action btn-danger-custom" data-i18n="clear_history">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card stat-card main-stat h-100">
                <div class="card-body">
                    <h5 class="card-subtitle" data-i18n="total_absent">–í—Å–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö</h5>
                    <p class="stat-number" id="totalAbsent">0</p>
                    <div class="stat-decorator"></div>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card stat-card h-100">
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-4" data-i18n="reason_stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏—á–∏–Ω</h5>
                    <div class="chart-wrapper">
                        <div class="canvas-container">
                            <canvas id="reasonChart"></canvas>
                        </div>
                        <div id="reasonLegend" class="custom-legend"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="classChartsContainer" class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mt-2"></div>
</div>

<div class="modal fade" id="excelModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg" style="background: #1a1a1a; border: 1px solid #333; border-radius: 20px;">
      <div class="modal-header border-bottom border-secondary">
        <h5 class="modal-title text-white fw-bold" data-i18n="select_period">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <div class="d-grid gap-3">
          <button class="btn btn-outline-primary py-3 fw-bold rounded-pill" onclick="handleExcelExport('day')">
            üìÖ <span data-i18n="report_day">–ó–∞ 1 –¥–µ–Ω—å</span>
          </button>
          <button class="btn btn-outline-info py-3 fw-bold rounded-pill" onclick="handleExcelExport('week')">
            üóìÔ∏è <span data-i18n="report_week">–ó–∞ –Ω–µ–¥–µ–ª—é (6 –¥–Ω.)</span>
          </button>
          <button class="btn btn-outline-warning py-3 fw-bold rounded-pill" onclick="handleExcelExport('month')">
            üìä <span data-i18n="report_month">–ó–∞ –º–µ—Å—è—Ü</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="admin.js"></script>
</body>
</html>
